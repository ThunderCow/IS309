/*
CREATE_OPPORTUNITY_SP. Add a new opportunity for an organization.  As with other 
procedures, this one will create a contact person by calling CREATE_PERSON_SP, 
and a location by calling CREATE_LOCATION_SP.

PARAMETERS:  Described below
RETURNS:  a new or existing opportunity_id, using the p_opportunity_id output parameter
PARAMETERS:  Described below
RETURNS:  a new or existing opportunity_id, identifying the opportunity.
ERROR MESSAGES:
    Error text:  "Missing mandatory value for parameter (x) in context (y). No opportunity added." 
	Error effect: Because a mandatory value is not provided, no data are 
            inserted into the VM_OPPORTUNITY table.  The p_opportunity_id value 
            returned is NULL.  Here, y = 'CREATE_OPPORTUNITY_SP'
            
    Errors with contact person or location data are generated by 
    CREATE_PERSON_SP and CREATE_LOCATION_SP procedures respectively.
    
    Error text:  "Invalid value for parameter (x) in context (y)  No opportunity added."
    Error meaning.  A parameter does not match the domain specification, i.e.
            the organization_type is not one of the permitted values in this 
            procedure.  Here, y = 'CREATE_OPPORTUNITY_SP'
    Error effect:  Because a value is invalid, no data are inserted into the
            VM_OPPORTUNITY table.  The p_opportunity_id value returned is
            NULL.
           
    Error text:  "Organization (x) not found.  No opportunity added."
    Error meaning:  The value of the p_org_id parameter does not match an 
        existing organization in the VM_ORGANIZATION table.
    Error effect:   Because a valid organization cannot be associated with
        the opportunity, no data are inserted into the VM_OPPORTUNITY table. 
        The p_opp_id value returned is NULL.        
            
    Error text:  "Invalid point of contact (x). No opportunity added."
    Error meaning:  The call to the CREATE_PERSON_SP routine has failed to 
        create or retrieve a person_id value.
    Error effect:   Because a valid point of contact cannot be associated with
        the organization, no data are inserted into the VM_OPPORTUNITY table. 
        The p_opp_id value returned is NULL.
        
*/

create or replace procedure CREATE_OPPORTUNITY_SP (
    p_opp_id                    OUT INTEGER,        -- output parameter
    p_org_id                    IN  INTEGER,        -- NOT NULL
    p_opp_title                 IN  VARCHAR,   -- NOT NULL
    p_opp_description           IN  LONG,       
    p_opp_create_date           IN  DATE,       -- If NULL, use SYSDATE
    p_opp_max_volunteers        IN  INTEGER,    -- If provided, must be > 0
    p_opp_min_volunteer_age     IN  INTEGER,    -- If provided, must be between 0 and 125
    p_opp_start_date            IN  DATE,
    p_opp_start_time            IN  CHAR,       
    p_opp_end_date              IN  DATE,
    p_opp_end_time              IN  CHAR,
    p_opp_status                IN  VARCHAR,    -- If provided, must conform to domain
    p_opp_great_for             IN  VARCHAR,    -- If provided, must conform to domain
    p_location_country	        IN	VARCHAR,  -- passed to CREATE_LOCATION_SP
    p_location_postal_code      IN	VARCHAR,  -- passed to CREATE_LOCATION_SP
    p_location_street1	        IN	VARCHAR,  -- passed to CREATE_LOCATION_SP
    p_location_street2	        IN	VARCHAR,  -- passed to CREATE_LOCATION_SP
    p_location_city	            IN	VARCHAR,  -- passed to CREATE_LOCATION_SP
    p_location_administrative_region IN VARCHAR,  -- passed to CREATE_LOCATION_SP
    p_person_email              IN VARCHAR,   -- passed to CREATE_PERSON_SP
    P_person_given_name         IN VARCHAR,   -- passed to CREATE_PERSON_SP
    p_person_surname            IN VARCHAR,   -- passed to CREATE_PERSON_SP
    p_person_phone              IN VARCHAR    -- passed to CREATE_PERSON_SP    
)
IS
BEGIN

if p_opp_id is null then
err_msg_txt := 'Missing mandatory value for parameter, OPPORTUNITY_ID  can not be null. 
The p_person_id value returned is NULL.  ';
raise ex_error;

elsif p_opp_title is null then
err_msg_txt := 'Missing mandatory value for parameter, OPPORTUNITY_TITLE  can not be null. 
The p_person_id value returned is NULL.  ';
raise ex_error;

elsif p_opp_description is null then
err_msg_txt := 'Missing mandatory value for parameter, OPPORTUNITY_DESCRIPTION  can not be null.
The p_person_id value returned is NULL.  ';
raise ex_error;

elsif p_opp_create_date is null then
err_msg_txt := 'Missing mandatory value for parameter, OPPORTUNITY_CREATE_DATE  can not be null. 
The p_person_id value returned is NULL.  ';
raise ex_error;
end if;

    NULL;
END;
/
